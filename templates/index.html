<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generation</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 50px; background-color: #f4f4f9; color: #333; }
        h1 { color: #4a4a4a; }
        #generation-form { display: flex; flex-direction: column; align-items: center; gap: 15px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #prompt { width: 400px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #loading { display: none; margin-top: 20px; color: #555; }
        #image-container { margin-top: 20px; min-height: 512px; }
        #result-image { border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h1>AI Image Generator</h1>
    <form id="generation-form">
        {% csrf_token %}
        <input type="text" id="prompt" name="prompt" placeholder="e.g., a photograph of an astronaut riding a horse" required>
        <button type="submit">Generate</button>
    </form>

    <div id="loading">Generating... please wait. This can take a minute on a GPU.</div>
    
    <div id="image-container">
        <img id="result-image" src="" alt="Generated Image" style="display:none; max-width: 512px; max-height: 512px;">
    </div>

    <script>
        const form = document.getElementById('generation-form');
        const loadingDiv = document.getElementById('loading');
        const resultImage = document.getElementById('result-image');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            loadingDiv.style.display = 'block';
            resultImage.style.display = 'none';

            const formElement = document.getElementById('generation-form');
            const formData = new FormData(formElement);

            try {
                const response = await fetch('/generate-image/', {
                    method: 'POST',
                    body: formData,
                });
                const data = await response.json();
                resultImage.src = data.image_url + '?t=' + new Date().getTime(); // Cache-busting
                resultImage.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred during image generation.');
            } finally {
                loadingDiv.style.display = 'none';
            }
        });
    </script>
</body>
</html>